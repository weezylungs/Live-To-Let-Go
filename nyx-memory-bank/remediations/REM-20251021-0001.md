# REM-20251021-0001 — Atomic Write/Sign/Verify Commit

## Problem
The current flow writes a ledger, signs it, then mutates and/or rewrites. This risks a mismatch between signed bytes and final on-disk bytes and enables TOCTOU if the commit is non-atomic.

## Required Pattern (canonical)
1. Serialize the full ledger to `TMP` (fsync).
2. Create a detached signature for `TMP`.
3. Immediately `gpg --verify signature.asc TMP`.
4. Atomically replace: `os.replace(TMP, FINAL)` and `os.replace(TMP.asc, FINAL.asc)`.
5. **Never** mutate the just-signed bytes. Any “signature metadata” goes in the *next* entry or a separate sidecar.

## Acceptance Criteria
- `POE-20251021-0001.sh` returns `0` consistently.
- `gpg --verify FINAL.asc FINAL` succeeds; any later change breaks verification as expected.
- No additional writes occur to `FINAL` between verify and atomic replace.

## Notes
Detached signatures validate *exact bytes*. They do not contain ledger content. Integrity depends on identical bytes from sign → verify → commit.
